import React, { useState } from 'react';
import { TrendingUp, Search, BarChart3, Newspaper, Brain, AlertCircle, DollarSign, Activity, Globe } from 'lucide-react';

const StockAnalyzer = () => {
  const [ticker, setTicker] = useState('');
  const [language, setLanguage] = useState('it');
  const [analysis, setAnalysis] = useState(null);
  const [loading, setLoading] = useState(false);
  const [activeTab, setActiveTab] = useState('analysis');

  const languages = {
    it: { name: 'üáÆüáπ Italiano', code: 'it' },
    en: { name: 'üá¨üáß English', code: 'en' },
    es: { name: 'üá™üá∏ Espa√±ol', code: 'es' },
    fr: { name: 'üá´üá∑ Fran√ßais', code: 'fr' },
    de: { name: 'üá©üá™ Deutsch', code: 'de' },
    pt: { name: 'üáµüáπ Portugu√™s', code: 'pt' },
    ru: { name: 'üá∑üá∫ –†—É—Å—Å–∫–∏–π', code: 'ru' },
    zh: { name: 'üá®üá≥ ‰∏≠Êñá', code: 'zh' },
    ja: { name: 'üáØüáµ Êó•Êú¨Ë™û', code: 'ja' },
    ar: { name: 'üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', code: 'ar' }
  };

  const translations = {
    it: {
      title: 'Analizzatore Investimenti AI',
      subtitle: 'Analisi azionarie potenziate dall\'intelligenza artificiale',
      disclaimer: 'Questa √® un\'analisi informativa, non un consiglio finanziario. I mercati sono imprevedibili. Consulta sempre un professionista prima di investire.',
      placeholder: 'Inserisci ticker (es: AAPL, TSLA, MSFT, NVDA...)',
      analyze: 'Analizza',
      analyzing: 'Analisi...',
      recommendation: 'Raccomandazione',
      confidence: 'Confidenza',
      targetPrice: 'Prezzo obiettivo',
      strengths: 'Punti di Forza',
      risks: 'Rischi',
      outlook: 'Prospettive',
      technicalAnalysis: 'Analisi Tecnica',
      fundamentals: 'Dati Fondamentali',
      news: 'Notizie',
      trend: 'Trend',
      support: 'Supporto',
      resistance: 'Resistenza',
      indicators: 'Indicatori',
      marketCap: 'Cap. di mercato',
      aiAnalysis: 'Analisi AI',
      buy: 'Acquisto',
      sell: 'Vendita',
      hold: 'Attesa'
    },
    en: {
      title: 'AI Investment Analyzer',
      subtitle: 'AI-powered stock analysis',
      disclaimer: 'This is informational analysis, not financial advice. Markets are unpredictable. Always consult a professional before investing.',
      placeholder: 'Enter ticker (e.g., AAPL, TSLA, MSFT, NVDA...)',
      analyze: 'Analyze',
      analyzing: 'Analyzing...',
      recommendation: 'Recommendation',
      confidence: 'Confidence',
      targetPrice: 'Target Price',
      strengths: 'Strengths',
      risks: 'Risks',
      outlook: 'Outlook',
      technicalAnalysis: 'Technical Analysis',
      fundamentals: 'Fundamentals',
      news: 'News',
      trend: 'Trend',
      support: 'Support',
      resistance: 'Resistance',
      indicators: 'Indicators',
      marketCap: 'Market Cap',
      aiAnalysis: 'AI Analysis',
      buy: 'Buy',
      sell: 'Sell',
      hold: 'Hold'
    },
    es: {
      title: 'Analizador de Inversiones IA',
      subtitle: 'An√°lisis de acciones potenciado por IA',
      disclaimer: 'Este es un an√°lisis informativo, no asesoramiento financiero. Los mercados son impredecibles. Consulte siempre a un profesional.',
      placeholder: 'Ingrese ticker (ej: AAPL, TSLA, MSFT, NVDA...)',
      analyze: 'Analizar',
      analyzing: 'Analizando...',
      recommendation: 'Recomendaci√≥n',
      confidence: 'Confianza',
      targetPrice: 'Precio objetivo',
      strengths: 'Fortalezas',
      risks: 'Riesgos',
      outlook: 'Perspectivas',
      technicalAnalysis: 'An√°lisis T√©cnico',
      fundamentals: 'Fundamentos',
      news: 'Noticias',
      trend: 'Tendencia',
      support: 'Soporte',
      resistance: 'Resistencia',
      indicators: 'Indicadores',
      marketCap: 'Cap. de mercado',
      aiAnalysis: 'An√°lisis IA',
      buy: 'Comprar',
      sell: 'Vender',
      hold: 'Mantener'
    },
    fr: {
      title: 'Analyseur d\'Investissement IA',
      subtitle: 'Analyse boursi√®re aliment√©e par l\'IA',
      disclaimer: 'Ceci est une analyse informative, pas un conseil financier. Les march√©s sont impr√©visibles. Consultez toujours un professionnel.',
      placeholder: 'Entrez le ticker (ex: AAPL, TSLA, MSFT, NVDA...)',
      analyze: 'Analyser',
      analyzing: 'Analyse...',
      recommendation: 'Recommandation',
      confidence: 'Confiance',
      targetPrice: 'Prix cible',
      strengths: 'Forces',
      risks: 'Risques',
      outlook: 'Perspectives',
      technicalAnalysis: 'Analyse Technique',
      fundamentals: 'Fondamentaux',
      news: 'Actualit√©s',
      trend: 'Tendance',
      support: 'Support',
      resistance: 'R√©sistance',
      indicators: 'Indicateurs',
      marketCap: 'Capitalisation',
      aiAnalysis: 'Analyse IA',
      buy: 'Acheter',
      sell: 'Vendre',
      hold: 'Conserver'
    },
    de: {
      title: 'KI-Investitionsanalysator',
      subtitle: 'KI-gest√ºtzte Aktienanalyse',
      disclaimer: 'Dies ist eine informative Analyse, keine Finanzberatung. M√§rkte sind unvorhersehbar. Konsultieren Sie immer einen Fachmann.',
      placeholder: 'Ticker eingeben (z.B. AAPL, TSLA, MSFT, NVDA...)',
      analyze: 'Analysieren',
      analyzing: 'Analysiere...',
      recommendation: 'Empfehlung',
      confidence: 'Vertrauen',
      targetPrice: 'Zielpreis',
      strengths: 'St√§rken',
      risks: 'Risiken',
      outlook: 'Ausblick',
      technicalAnalysis: 'Technische Analyse',
      fundamentals: 'Fundamentaldaten',
      news: 'Nachrichten',
      trend: 'Trend',
      support: 'Unterst√ºtzung',
      resistance: 'Widerstand',
      indicators: 'Indikatoren',
      marketCap: 'Marktkapitalisierung',
      aiAnalysis: 'KI-Analyse',
      buy: 'Kaufen',
      sell: 'Verkaufen',
      hold: 'Halten'
    },
    pt: {
      title: 'Analisador de Investimentos IA',
      subtitle: 'An√°lise de a√ß√µes com IA',
      disclaimer: 'Esta √© uma an√°lise informativa, n√£o aconselhamento financeiro. Os mercados s√£o imprevis√≠veis. Consulte sempre um profissional.',
      placeholder: 'Digite o ticker (ex: AAPL, TSLA, MSFT, NVDA...)',
      analyze: 'Analisar',
      analyzing: 'Analisando...',
      recommendation: 'Recomenda√ß√£o',
      confidence: 'Confian√ßa',
      targetPrice: 'Pre√ßo alvo',
      strengths: 'Pontos Fortes',
      risks: 'Riscos',
      outlook: 'Perspectivas',
      technicalAnalysis: 'An√°lise T√©cnica',
      fundamentals: 'Fundamentos',
      news: 'Not√≠cias',
      trend: 'Tend√™ncia',
      support: 'Suporte',
      resistance: 'Resist√™ncia',
      indicators: 'Indicadores',
      marketCap: 'Cap. de mercado',
      aiAnalysis: 'An√°lise IA',
      buy: 'Comprar',
      sell: 'Vender',
      hold: 'Manter'
    },
    ru: {
      title: '–ò–ò –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–π',
      subtitle: '–ê–Ω–∞–ª–∏–∑ –∞–∫—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –ò–ò',
      disclaimer: '–≠—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑, –∞ –Ω–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è. –†—ã–Ω–∫–∏ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã. –í—Å–µ–≥–¥–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º.',
      placeholder: '–í–≤–µ–¥–∏—Ç–µ —Ç–∏–∫–µ—Ä (–Ω–∞–ø—Ä: AAPL, TSLA, MSFT, NVDA...)',
      analyze: '–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å',
      analyzing: '–ê–Ω–∞–ª–∏–∑...',
      recommendation: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è',
      confidence: '–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å',
      targetPrice: '–¶–µ–ª–µ–≤–∞—è —Ü–µ–Ω–∞',
      strengths: '–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞',
      risks: '–†–∏—Å–∫–∏',
      outlook: '–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã',
      technicalAnalysis: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ê–Ω–∞–ª–∏–∑',
      fundamentals: '–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ',
      news: '–ù–æ–≤–æ—Å—Ç–∏',
      trend: '–¢—Ä–µ–Ω–¥',
      support: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞',
      resistance: '–°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ',
      indicators: '–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã',
      marketCap: '–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è',
      aiAnalysis: '–ò–ò –ê–Ω–∞–ª–∏–∑',
      buy: '–ö—É–ø–∏—Ç—å',
      sell: '–ü—Ä–æ–¥–∞—Ç—å',
      hold: '–î–µ—Ä–∂–∞—Ç—å'
    },
    zh: {
      title: 'AIÊäïËµÑÂàÜÊûêÂô®',
      subtitle: 'AIÈ©±Âä®ÁöÑËÇ°Á•®ÂàÜÊûê',
      disclaimer: 'ËøôÊòØ‰ø°ÊÅØÂàÜÊûêÔºå‰∏çÊòØË¥¢Âä°Âª∫ËÆÆ„ÄÇÂ∏ÇÂú∫‰∏çÂèØÈ¢ÑÊµã„ÄÇÊäïËµÑÂâçËØ∑Âí®ËØ¢‰∏ì‰∏ö‰∫∫Â£´„ÄÇ',
      placeholder: 'ËæìÂÖ•ËÇ°Á•®‰ª£Á†ÅÔºà‰æãÔºöAAPL, TSLA, MSFT, NVDA...Ôºâ',
      analyze: 'ÂàÜÊûê',
      analyzing: 'ÂàÜÊûê‰∏≠...',
      recommendation: 'Âª∫ËÆÆ',
      confidence: '‰ø°ÂøÉ',
      targetPrice: 'ÁõÆÊ†á‰ª∑Ê†º',
      strengths: '‰ºòÂäø',
      risks: 'È£éÈô©',
      outlook: 'Â±ïÊúõ',
      technicalAnalysis: 'ÊäÄÊúØÂàÜÊûê',
      fundamentals: 'Âü∫Êú¨Èù¢',
      news: 'Êñ∞Èóª',
      trend: 'Ë∂ãÂäø',
      support: 'ÊîØÊíë',
      resistance: 'ÈòªÂäõ',
      indicators: 'ÊåáÊ†á',
      marketCap: 'Â∏ÇÂÄº',
      aiAnalysis: 'AIÂàÜÊûê',
      buy: '‰π∞ÂÖ•',
      sell: 'ÂçñÂá∫',
      hold: 'ÊåÅÊúâ'
    },
    ja: {
      title: 'AIÊäïË≥á„Ç¢„Éä„É©„Ç§„Ç∂„Éº',
      subtitle: 'AI„Å´„Çà„ÇãÊ†™ÂºèÂàÜÊûê',
      disclaimer: '„Åì„Çå„ÅØÊÉÖÂ†±ÂàÜÊûê„Åß„ÅÇ„Çä„ÄÅË≤°Âãô„Ç¢„Éâ„Éê„Ç§„Çπ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂ∏ÇÂ†¥„ÅØ‰∫àÊ∏¨‰∏çÂèØËÉΩ„Åß„Åô„ÄÇÊäïË≥áÂâç„Å´Â∞ÇÈñÄÂÆ∂„Å´Áõ∏Ë´á„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
      placeholder: '„ÉÜ„Ç£„ÉÉ„Ç´„Éº„ÇíÂÖ•ÂäõÔºà‰æãÔºöAAPL, TSLA, MSFT, NVDA...Ôºâ',
      analyze: 'ÂàÜÊûê',
      analyzing: 'ÂàÜÊûê‰∏≠...',
      recommendation: 'Êé®Â•®',
      confidence: '‰ø°È†ºÂ∫¶',
      targetPrice: 'ÁõÆÊ®ô‰æ°Ê†º',
      strengths: 'Âº∑„Åø',
      risks: '„É™„Çπ„ÇØ',
      outlook: 'Ë¶ãÈÄö„Åó',
      technicalAnalysis: '„ÉÜ„ÇØ„Éã„Ç´„É´ÂàÜÊûê',
      fundamentals: '„Éï„Ç°„É≥„ÉÄ„É°„É≥„Çø„É´„Ç∫',
      news: '„Éã„É•„Éº„Çπ',
      trend: '„Éà„É¨„É≥„Éâ',
      support: '„Çµ„Éù„Éº„Éà',
      resistance: '„É¨„Ç∏„Çπ„Çø„É≥„Çπ',
      indicators: 'ÊåáÊ®ô',
      marketCap: 'ÊôÇ‰æ°Á∑èÈ°ç',
      aiAnalysis: 'AIÂàÜÊûê',
      buy: 'Ë≤∑„ÅÑ',
      sell: 'Â£≤„Çä',
      hold: '‰øùÊåÅ'
    },
    ar: {
      title: 'ŸÖÿ≠ŸÑŸÑ ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÖÿßÿ± ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä',
      subtitle: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ£ÿ≥ŸáŸÖ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä',
      disclaimer: 'Ÿáÿ∞ÿß ÿ™ÿ≠ŸÑŸäŸÑ ŸÖÿπŸÑŸàŸÖÿßÿ™Ÿä ŸàŸÑŸäÿ≥ ŸÜÿµŸäÿ≠ÿ© ŸÖÿßŸÑŸäÿ©. ÿßŸÑÿ£ÿ≥ŸàÿßŸÇ ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ŸÜÿ®ÿ§ ÿ®Ÿáÿß. ÿßÿ≥ÿ™ÿ¥ÿ± ÿØÿßÿ¶ŸÖŸãÿß ŸÖÿ™ÿÆÿµÿµŸãÿß.',
      placeholder: 'ÿ£ÿØÿÆŸÑ ÿßŸÑÿ±ŸÖÿ≤ (ŸÖÿ´ÿßŸÑ: AAPL, TSLA, MSFT, NVDA...)',
      analyze: 'ÿ™ÿ≠ŸÑŸäŸÑ',
      analyzing: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ...',
      recommendation: 'ÿßŸÑÿ™ŸàÿµŸäÿ©',
      confidence: 'ÿßŸÑÿ´ŸÇÿ©',
      targetPrice: 'ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÖÿ≥ÿ™ŸáÿØŸÅ',
      strengths: 'ŸÜŸÇÿßÿ∑ ÿßŸÑŸÇŸàÿ©',
      risks: 'ÿßŸÑŸÖÿÆÿßÿ∑ÿ±',
      outlook: 'ÿßŸÑÿ™ŸàŸÇÿπÿßÿ™',
      technicalAnalysis: 'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅŸÜŸä',
      fundamentals: 'ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©',
      news: 'ÿßŸÑÿ£ÿÆÿ®ÿßÿ±',
      trend: 'ÿßŸÑÿßÿ™ÿ¨ÿßŸá',
      support: 'ÿßŸÑÿØÿπŸÖ',
      resistance: 'ÿßŸÑŸÖŸÇÿßŸàŸÖÿ©',
      indicators: 'ÿßŸÑŸÖÿ§ÿ¥ÿ±ÿßÿ™',
      marketCap: 'ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ≥ŸàŸÇŸäÿ©',
      aiAnalysis: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä',
      buy: 'ÿ¥ÿ±ÿßÿ°',
      sell: 'ÿ®Ÿäÿπ',
      hold: 'ÿßÿ≠ÿ™ŸÅÿ∏'
    }
  };

  const t = translations[language];

  const analyzeStock = async () => {
    if (!ticker.trim()) return;
    
    setLoading(true);
    setAnalysis(null);

    try {
      const languageInstructions = {
        it: 'Rispondi in Italiano',
        en: 'Respond in English',
        es: 'Responde en Espa√±ol',
        fr: 'R√©ponds en Fran√ßais',
        de: 'Antworte auf Deutsch',
        pt: 'Responda em Portugu√™s',
        ru: '–û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º',
        zh: 'Áî®‰∏≠ÊñáÂõûÁ≠î',
        ja: 'Êó•Êú¨Ë™û„ÅßÁ≠î„Åà„Å¶„Åè„Å†„Åï„ÅÑ',
        ar: 'ÿ£ÿ¨ÿ® ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'
      };

      const searchResponse = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 4000,
          tools: [
            {
              type: "web_search_20250305",
              name: "web_search"
            }
          ],
          messages: [
            {
              role: "user",
              content: `${languageInstructions[language]}. Search for updated information about the stock ${ticker.toUpperCase()} and provide a complete analysis in JSON format with this exact structure:
              
{
  "company": "Full company name",
  "sector": "Sector",
  "currentPrice": "Current price (number)",
  "priceChange": "% change (with + or -)",
  "marketCap": "Market capitalization",
  "fundamentals": {
    "pe": "P/E ratio",
    "revenue": "Recent revenue",
    "eps": "Earnings per share"
  },
  "technicalAnalysis": {
    "trend": "Bullish/Bearish/Sideways (translated to ${language})",
    "support": "Support level",
    "resistance": "Resistance level",
    "indicators": "RSI, MACD, etc."
  },
  "recentNews": [
    {"title": "News title", "summary": "Brief summary", "date": "Date"},
    {"title": "News title", "summary": "Brief summary", "date": "Date"}
  ],
  "aiInsights": {
    "strengths": ["Pro 1", "Pro 2", "Pro 3"],
    "risks": ["Risk 1", "Risk 2", "Risk 3"],
    "outlook": "Short-medium term outlook"
  },
  "recommendation": {
    "action": "Buy/Hold/Sell (translated to ${language})",
    "confidence": "High/Medium/Low (translated to ${language})",
    "reasoning": "Rating explanation",
    "targetPrice": "Estimated target price"
  }
}

Important: 
- Use real, updated data from web search
- Be objective and balanced
- Clearly indicate risks
- ALL text fields must be in ${languages[language].name}
- Respond ONLY with JSON, no additional text`
            }
          ]
        })
      });

      const data = await searchResponse.json();
      
      let responseText = '';
      for (const block of data.content) {
        if (block.type === 'text') {
          responseText += block.text;
        }
      }

      const jsonMatch = responseText.match(/\{[\s\S]*\}/);
      if (jsonMatch) {
        const cleanJson = jsonMatch[0].replace(/```json|```/g, '').trim();
        const parsedData = JSON.parse(cleanJson);
        setAnalysis(parsedData);
      } else {
        throw new Error('Invalid response format');
      }

    } catch (error) {
      console.error('Analysis error:', error);
      setAnalysis({
        error: true,
        message: 'Unable to retrieve data. Verify the ticker and try again.'
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white p-6">
      <div className="max-w-7xl mx-auto mb-8">
        <div className="flex justify-between items-start mb-4">
          <div className="flex items-center gap-3">
            <div className="p-3 bg-gradient-to-br from-emerald-400 to-cyan-500 rounded-xl">
              <TrendingUp className="w-8 h-8" />
            </div>
            <div>
              <h1 className="text-4xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
                {t.title}
              </h1>
              <p className="text-slate-400 text-sm">{t.subtitle}</p>
            </div>
          </div>

          <div className="flex items-center gap-2 bg-slate-800/50 rounded-lg p-2">
            <Globe className="w-5 h-5 text-slate-400" />
            <select
              value={language}
              onChange={(e) => setLanguage(e.target.value)}
              className="bg-transparent text-white border-none outline-none cursor-pointer"
            >
              {Object.entries(languages).map(([code, lang]) => (
                <option key={code} value={code} className="bg-slate-800">
                  {lang.name}
                </option>
              ))}
            </select>
          </div>
        </div>

        <div className="mt-4 bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 flex gap-3">
          <AlertCircle className="w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5" />
          <div className="text-sm text-amber-200">
            <strong>‚ö†Ô∏è {t.confidence}:</strong> {t.disclaimer}
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto mb-8">
        <div className="flex gap-3">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5" />
            <input
              type="text"
              value={ticker}
              onChange={(e) => setTicker(e.target.value.toUpperCase())}
              onKeyDown={(e) => e.key === 'Enter' && !loading && ticker.trim() && analyzeStock()}
              placeholder={t.placeholder}
              className="w-full pl-12 pr-4 py-4 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
            />
          </div>
          <button
            onClick={analyzeStock}
            disabled={loading || !ticker.trim()}
            className="px-8 py-4 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-xl font-semibold hover:from-emerald-600 hover:to-cyan-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
          >
            {loading ? (
              <>
                <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
                {t.analyzing}
              </>
            ) : (
              <>
                <Brain className="w-5 h-5" />
                {t.analyze}
              </>
            )}
          </button>
        </div>
      </div>

      {analysis && !analysis.error && (
        <div className="max-w-7xl mx-auto">
          <div className="bg-gradient-to-r from-slate-800/80 to-slate-800/60 backdrop-blur-sm rounded-xl p-6 mb-6 border border-slate-700/50">
            <div className="flex justify-between items-start">
              <div>
                <h2 className="text-3xl font-bold mb-2">{analysis.company}</h2>
                <p className="text-slate-400">{analysis.sector}</p>
              </div>
              <div className="text-right">
                <div className="text-4xl font-bold text-emerald-400">
                  ${analysis.currentPrice}
                </div>
                <div className={`text-lg ${analysis.priceChange?.startsWith('+') ? 'text-emerald-400' : 'text-red-400'}`}>
                  {analysis.priceChange}
                </div>
              </div>
            </div>
            <div className="mt-4 text-slate-400">
              {t.marketCap}: <span className="text-white font-semibold">{analysis.marketCap}</span>
            </div>
          </div>

          <div className="flex gap-2 mb-6 overflow-x-auto">
            {[
              { id: 'analysis', label: t.aiAnalysis, icon: Brain },
              { id: 'technical', label: t.technicalAnalysis, icon: Activity },
              { id: 'fundamentals', label: t.fundamentals, icon: BarChart3 },
              { id: 'news', label: t.news, icon: Newspaper }
            ].map(tab => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-all whitespace-nowrap ${
                  activeTab === tab.id
                    ? 'bg-gradient-to-r from-emerald-500 to-cyan-500 text-white'
                    : 'bg-slate-800/50 text-slate-400 hover:bg-slate-800'
                }`}
              >
                <tab.icon className="w-5 h-5" />
                {tab.label}
              </button>
            ))}
          </div>

          <div className="space-y-6">
            {activeTab === 'analysis' && (
              <>
                <div className={`rounded-xl p-6 border-2 ${
                  analysis.recommendation?.action?.toLowerCase().includes(t.buy.toLowerCase()) ? 'bg-emerald-500/10 border-emerald-500/50' :
                  analysis.recommendation?.action?.toLowerCase().includes(t.sell.toLowerCase()) ? 'bg-red-500/10 border-red-500/50' :
                  'bg-amber-500/10 border-amber-500/50'
                }`}>
                  <div className="flex items-center gap-3 mb-4">
                    <DollarSign className="w-8 h-8" />
                    <div>
                      <h3 className="text-2xl font-bold">{t.recommendation}: {analysis.recommendation?.action}</h3>
                      <p className="text-sm opacity-80">{t.confidence}: {analysis.recommendation?.confidence}</p>
                    </div>
                  </div>
                  <p className="mb-4">{analysis.recommendation?.reasoning}</p>
                  {analysis.recommendation?.targetPrice && (
                    <div className="text-lg">
                      <strong>{t.targetPrice}:</strong> {analysis.recommendation.targetPrice}
                    </div>
                  )}
                </div>

                <div className="grid md:grid-cols-2 gap-6">
                  <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700/50">
                    <h3 className="text-xl font-bold mb-4 text-emerald-400">‚úì {t.strengths}</h3>
                    <ul className="space-y-2">
                      {analysis.aiInsights?.strengths?.map((strength, i) => (
                        <li key={i} className="flex gap-2">
                          <span className="text-emerald-400">‚Ä¢</span>
                          <span>{strength}</span>
                        </li>
                      ))}
                    </ul>
                  </div>

                  <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700/50">
                    <h3 className="text-xl font-bold mb-4 text-red-400">‚ö† {t.risks}</h3>
                    <ul className="space-y-2">
                      {analysis.aiInsights?.risks?.map((risk, i) => (
                        <li key={i} className="flex gap-2">
                          <span className="text-red-400">‚Ä¢</span>
                          <span>{risk}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                </div>

                <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700/50">
                  <h3 className="text-xl font-bold mb-3">üîÆ {t.outlook}</h3>
                  <p className="text-slate-300">{analysis.aiInsights?.outlook}</p>
                </div>
              </>
            )}

            {activeTab === 'technical' && (
              <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700/50">
                <h3 className="text-2xl font-bold mb-6">{t.technicalAnalysis}</h3>
                <div className="grid md:grid-cols-2 gap-6">
                  <div>
                    <div className="mb-4">
                      <span className="text-slate-400">{t.trend}:</span>
                      <span className="ml-2 font-bold text-emerald-400">
                        {analysis.technicalAnalysis?.trend}
                      </span>
                    </div>
                    <div className="mb-4">
                      <span className="text-slate-400">{t.support}:</span>
                      <span className="ml-2 font-semibold">{analysis.technicalAnalysis?.support}</span>
                    </div>
                    <div>
                      <span className="text-slate-400">{t.resistance}:</span>
                      <span className="ml-2 font-semibold">{analysis.technicalAnalysis?.resistance}</span>
                    </div>
                  </div>
                  <div>
                    <h4 className="font-semibold mb-2 text-slate-300">{t.indicators}:</h4>
                    <p className="text-slate-400">{analysis.technicalAnalysis?.indicators}</p>
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'fundamentals' && (
              <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700/50">
                <h3 className="text-2xl font-bold mb-6">{t.fundamentals}</h3>
                <div className="grid md:grid-cols-3 gap-6">
                  <div className="bg-slate-900/50 rounded-lg p-4">
                    <div className="text-slate-400 text-sm mb-1">P/E Ratio</div>
                    <div className="text-2xl font-bold">{analysis.fundamentals?.pe}</div>
                  </div>
                  <div className="bg-slate-900/50 rounded-lg p-4">
                    <div className="text-slate-400 text-sm mb-1">Revenue</div>
                    <div className="text-2xl font-bold">{analysis.fundamentals?.revenue}</div>
                  </div>
                  <div className="bg-slate-900/50 rounded-lg p-4">
                    <div className="text-slate-400 text-sm mb-1">EPS</div>
                    <div className="text-2xl font-bold">{analysis.fundamentals?.eps}</div>
                  </div>
                </div>
              </div>
            )}

            
